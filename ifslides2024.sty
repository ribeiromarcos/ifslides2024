\ProvidesPackage{ifslides2024}
% Tema do IFMG para Beamer
% Marcos Roberto Ribeiro - marcos.ribeiro@ifmg.edu.br

% ==================================================

% Pacotes necessários
\RequirePackage{adjustbox}                % Pacote para reduzir/ampliar
\RequirePackage{ifthen}                   % Pacote para testar condições
\RequirePackage{tikz}                     % Pacote para desenho
\usetikzlibrary{shapes,positioning,fit,backgrounds}   % Bibliotecas para desenho
\RequirePackage[T1]{fontenc}              % Seleção de códigos de fonte
\RequirePackage[utf8]{inputenc}           % Codificação
\RequirePackage[brazil]{babel}            % Babel em português
\RequirePackage{opensans}
\RequirePackage{helvet}                   % Fonte arial
\renewcommand{\familydefault}{\sfdefault} % Define arial como fonte padrão
\RequirePackage{biblatexfix}              % Referências
\RequirePackage[threshold=3]{csquotes}    % Citações

% ==================================================

% Comandos para página de título
\newcommand{\titulo}{\title}              % Título
\newcommand{\subtitulo}{\subtitle}        % Subtítulo
\newcommand{\autor}{\author}              % Autor
\providecommand{\insertemail}{}           % E-mail
\newcommand{\email}[1]{%
  \renewcommand{\insertemail}{#1}}%
\newcommand{\data}{\date}%                % Data
\providecommand{\insertinfo}{}            % Informaçõesa adicionais
\newcommand{\info}[1]{%
\renewcommand{\insertinfo}{#1}}%
\providecommand{\insertcampus}{}          % Campus
\newcommand{\campus}[1]{%
  \renewcommand{\insertcampus}{#1}}%

% ==================================================

% Definição de cores
\definecolor{verde}{RGB}{63,165,53}%
\definecolor{cinza}{RGB}{128,128,128}%

% ==================================================

% Alterações no tema
\usecolortheme[named=verde]{structure}   % Cor padrão verde
\setbeamertemplate{navigation symbols}{} % Remove símbolos de navegação
\setbeamertemplate{blocks}[rectangles]   % Blocos retangulares
\setbeamerfont{frametitle}{series=\bfseries} % Título do slide em negrito
\useinnertheme{rectangles}                % Tema interno de retângulos
\setbeamercolor{section in toc}{fg=black} % Itens de sumário

% Bloco de alerta
\setbeamercolor{block body alerted}{bg=verde,fg=white}%
\setbeamerfont{block title alerted}{series=\bfseries}%
\setbeamercolor{block title alerted}{bg=verde,fg=white}%

% Bibliografia
\setbeamercolor{bibliography entry author}{fg=black}%
\setbeamercolor{bibliography entry title}{fg=black}%
\setbeamercolor{bibliography entry location}{fg=black}%
\setbeamercolor{bibliography entry note}{fg=black}%
\setbeamercolor{bibliography item}{fg=black}%
\setlength{\bibitemsep}{1em}%

% ==================================================

% Mudança no tamanho das margens
\setbeamersize{text margin left=5pt,text margin right=5pt}%

% ==================================================

% Logo IFMG
\tikzstyle{circulo}=[circle, minimum size=1.1cm]%
\tikzstyle{quadrado}=[rounded corners=0.1cm, minimum size=1cm]%
\newcommand{\fontopensans}[1]{\opensans\fontsize{#1}{#1}\selectfont}%

\newcommand{\iflogo}{%
  \renewcommand{\arraystretch}{1.2}%
  \begin{tikzpicture}[baseline,node distance=0.2cm,inner sep=0pt]%
    \node (q12) [quadrado, fill={white}] {};%
    \node (q13) [quadrado, fill={white}, right=of q12] {};%
    \node (q22) [quadrado, fill={white}, below=of q12] {};%
    \node (q21) [quadrado, fill={white}, left=of q22] {};%
    \node (q31) [quadrado, fill={white}, below=of q21] {};%
    \node (q32) [quadrado, fill={white}, right=of q31] {};%
    \node (q33) [quadrado, fill={white}, right=of q32] {};%
    \node (q41) [quadrado, fill={white}, below=of q31] {};%
    \node (q42) [quadrado, fill={white}, right=of q41] {};%
    \node (c) [circulo, fill={white}] at (q12 -| q21) {};%
    \node (instituto) [white,node distance=0.7cm, below=of q42] {\bfseries\fontopensans{38.7} INSTITUTO};%
    \node (federal) [white, below=of instituto] {\bfseries\fontopensans{38.7} FEDERAL};%
    \node (mg) [white,node distance=0.45cm, below=of federal] {\fontopensans{30} Minas Gerais};%
    \node (linha) [white, node distance=0.4cm, below=of mg] {\rule{8.2cm}{1pt}};%
    \node (campus) [white, node distance=0.4cm, below=of linha] {\fontopensans{30} \begin{tabular}{c} \insertcampus \end{tabular}};%
  \end{tikzpicture}%
}

% ==================================================
% Slide principal

\setbeamertemplate{title page}{%
  \vspace*{-1cm}
  \begin{center}
    {\Large\bfseries \inserttitle\par}%
    \vfill
    {\bfseries\itshape\insertsubtitle\par}%
    \vfill
    \insertauthor\par%
    \ifthenelse{\equal{\insertemail}{}}{}{\small\insertemail\par}%
    \vfill
    \ifthenelse{\equal{\insertinfo}{}}{}{\footnotesize\insertinfo\par}%
    {\footnotesize\insertdate}\vspace*{2em}\par%
    \adjustbox{scale=0.25}{\iflogo}%
  \end{center}
}

% ==================================================
% Cabeçalho

\newcommand{\cabecalho}{%
\hbox{%
  \begin{beamercolorbox}[ht=18pt,dp=0.3cm,wd=0.75\paperwidth,left]{}%
    \normalsize\bfseries\color{white}\hspace{5mm}%
       IFMG%
  \end{beamercolorbox}%
  \begin{beamercolorbox}[dp=0.3cm,wd=0.23\paperwidth,right]{}%
    \color{gray}\normalsize\insertframenumber%
  \end{beamercolorbox}%
 }%
}%

\newcommand{\cabecalhoplain}{%
\hbox{%
  \begin{beamercolorbox}[ht=18pt,dp=0.3cm,wd=0.75\paperwidth,left]{}%
    \normalsize\bfseries\color{verde}\hspace{5mm}%
       IFMG%
  \end{beamercolorbox}%
  \begin{beamercolorbox}[dp=0.3cm,wd=0.23\paperwidth,right]{}%
    \color{verde}\normalsize\insertframenumber%
  \end{beamercolorbox}%
 }%
}%

\setbeamertemplate{headline}{\cabecalho}%

% ==================================================

% Plano de fundo
\newcommand{\fundoverde}{%
  \begin{tikzpicture}[remember picture, overlay]%
   \node (fundo)%
   [xshift=3pt, yshift=-3pt,anchor=north west,%
   fill=verde,minimum width=\paperwidth-6pt,%
   minimum height=\paperheight-6pt, rounded corners=2mm] {};%
  \end{tikzpicture}%
}%

\newcommand{\fundopadrao}{%
  \begin{tikzpicture}%
  \node (ini) {};%
  \node (ifmg)
  [below of=ini, node distance=10pt,minimum width=18mm,%
  minimum height=0.5cm] {};%
  \path[fill=verde] (ifmg.north east) -- (ifmg.south east) --%
  (ifmg.south west) -- (ifmg.north west) [rounded corners=5pt] -- cycle;%
  \end{tikzpicture}%
}%

% ==================================================
% Personalização do bloco padrão

\setbeamercolor{block title}{fg=black}%
\setbeamertemplate{block begin}{%
  \ifthenelse{\equal{\insertblocktitle}{}}{}{%
    \begin{beamercolorbox}[wd=\linewidth]{block title}%
      \usebeamerfont*{block title}%
      \begin{tikzpicture}[node distance=5pt,inner sep=0pt]%
        \node (t) [text width=0.9\linewidth, align=left, inner sep=3pt] %
          {\bfseries\insertblocktitle}; %
        \node (es) [left=of t.north west] {}; %
        \node (ei) [left=of t.south west] {}; %
        \node (l) [fill=verde, minimum width=5pt, fit=(es) (ei)] {}; %
      \end{tikzpicture} %
    \end{beamercolorbox}%
    {\parskip0pt\par}%
  } %
  \ifbeamercolorempty[bg]{block title}{} %
    {\ifbeamercolorempty[bg]{block body}{}{\nointerlineskip\vskip-0.5pt}}%
  \usebeamerfont{block body}%
  \begin{beamercolorbox}[wd=\linewidth,vmode,sep=5pt]{block body}%
     \ifbeamercolorempty[bg]{block body}{\vskip-.25ex}{\vskip-.75ex}\vbox{}%
} %
\setbeamertemplate{block end}{ %
  \end{beamercolorbox} %
} %

% ==================================================
% Personalização do bloco exemplo

\setbeamertemplate{block example begin}{%
  \ifthenelse{\equal{\insertblocktitle}{}}{}{ %
    \begin{beamercolorbox}[colsep*=.75ex]{block title example} %
      \usebeamerfont*{block title example}\bfseries\insertblocktitle%
    \end{beamercolorbox}%
    {\parskip0pt\par}%
  }
  \usebeamerfont{block body example}%
  \begin{beamercolorbox}[colsep*=.75ex,vmode]{block body example}%
      \ifbeamercolorempty[bg]{block body example}{\vskip-.25ex}{\vskip-.75ex}\vbox{}%
} %
\setbeamertemplate{block example end}{ %
  \end{beamercolorbox} %
} %

% ==================================================
% Personalização do bloco de alerta

\setbeamertemplate{block alerted begin}{%
  \ifthenelse{\equal{\insertblocktitle}{}}{}{ %
    \begin{beamercolorbox}[colsep*=.75ex]{block title alerted} %
      \usebeamerfont*{block title alerted}\insertblocktitle%
    \end{beamercolorbox}%
    {\parskip0pt\par}%
  } %
  \ifbeamercolorempty[bg]{block title alerted}{} %
  {\ifbeamercolorempty[bg]{block body alerted}{}{\nointerlineskip\vskip-0.5pt}}%
  \usebeamerfont{block body alerted}%
  \begin{beamercolorbox}[colsep*=.75ex,vmode]{block body alerted}%
    \setbeamercolor*{item}{fg=verde,fg=white} %
    \ifbeamercolorempty[bg]{block body alerted}{\vskip-.25ex}{\vskip-.75ex}\vbox{}%
}
\setbeamertemplate{block alerted end}{ %
  \end{beamercolorbox}
} %

% ==================================================

% Título centralizado
\newcommand{\titulocentro}{%
  \begin{center}%
    \insertframetitle%
  \end{center}%
  \vspace*{-1.5em}%
}%

% Mudança ente frame padrão e plain
\makeatletter %
\define@key{beamerframe}{plain}[true]{%
  \usebackgroundtemplate{\fundoverde}%
  \setbeamercolor{frametitle}{fg=white}%
  \setbeamertemplate{headline}{\cabecalhoplain}%
  \setbeamertemplate{frametitle}{\titulocentro} %
  \setbeamercolor{structure}{fg = white} %
  \setbeamercolor{normal text}{fg = white} %
  \usebeamercolor[fg]{normal text} %
}%
\BeforeBeginEnvironment{frame}{%
  \usebackgroundtemplate{\fundopadrao}%
  \setbeamercolor{frametitle}{fg=verde}%
  \setbeamertemplate{headline}{\cabecalho} %
  \setbeamercolor{structure}{fg = verde} %
  \setbeamercolor{normal text}{fg = black} %
  \usebeamercolor[fg]{normal text} %
  \setbeamertemplate{frametitle}{\insertframetitle} %
} %
\makeatother %
